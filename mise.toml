[tools]
python = "3.13"

[tasks.install]
description = "Install project dependencies"
run = "pip install -e '.[dev]'"

[tasks.verify]
description = "Verify video: mise run verify -- VIDEO AUDIO"
run = "python scripts/verify_video.py {{arg(i=0)}} {{arg(i=1)}}"
# Example: mise run verify -- youtube/output/01-attention.mp4 youtube/pl/audio/01-attention.m4a

[tasks.transcribe]
description = "Transcribe audio files"
run = "python scripts/transcribe.py {{arg(i=0, default='3')}}"
# Example: mise run transcribe -- 4

[tasks.analyze-transcript]
description = "Analyze transcript for slide generation: mise run analyze-transcript -- EP_NUM"
run = "python scripts/analyze_transcript.py {{arg(i=0)}}"
# Example: mise run analyze-transcript -- 73

[tasks.prepare]
description = "Prepare slides for video: mise run prepare -- EPISODE_NUM"
run = "python scripts/prepare_slides.py {{arg(i=0)}}"
# Example: mise run prepare -- 26

[tasks.generate-concat]
description = "Generate concat.txt from slide timings: mise run generate-concat -- EP_NUM --durations TIMINGS"
run = "python scripts/generate_concat.py"
raw = true
# Example: mise run generate-concat -- 55 --durations slide-01:180,slide-02:150
# Example: mise run generate-concat -- 55 --json timings.json --dry-run

[tasks.video]
description = "Generate video from concat.txt: mise run video -- EPISODE_NUM"
run = "python scripts/generate_video.py {{arg(i=0)}} {{option(name='skip-verify', short='s')}}"
# Example: mise run video -- 28
# Example: mise run video -- 28 -s

[tasks.compress]
description = "Compress PNG files: mise run compress -- PATH [--threshold SIZE]"
run = "python scripts/compress_images.py {{arg(i=0)}} {{arg(i=1)}} {{arg(i=2)}} {{arg(i=3)}} {{arg(i=4)}}"
# Example: mise run compress -- youtube/thumbnails/
# Example: mise run compress -- youtube/thumbnails/ --threshold 1MB --dry-run

[tasks.verify-concat]
description = "Verify concat.txt: mise run verify-concat -- EPISODE_NUM [--check-dims]"
run = "python scripts/verify_concat.py"
raw = true
# Example: mise run verify-concat -- 28
# Example: mise run verify-concat -- 28 --check-dims

[tasks.rename-audio]
description = "Rename audio files to match whitepaper names"
run = "python scripts/rename_audio.py"

[tasks.rename-slides]
description = "Rename slides dirs/PDFs to match whitepaper names"
run = "python scripts/rename_slides.py"

[tasks.rename-thumbnails]
description = "Rename thumbnails to match whitepaper names and compress"
run = "python scripts/rename_thumbnails.py"
raw = true

[tasks.lint]
description = "Run all linters"
run = ["ruff check scripts/", "markdownlint '**/*.md'"]

[tasks."lint:python"]
description = "Run ruff linter"
run = "ruff check scripts/"

[tasks."lint:md"]
description = "Run markdownlint"
run = "markdownlint '**/*.md'"

[tasks.format]
description = "Format code with ruff"
run = "ruff format scripts/"

[tasks.upload]
description = "Upload video to YouTube: mise run upload -- EPISODE_NUM"
run = "python scripts/upload_youtube.py {{arg(i=0)}} {{option(name='dry-run')}} {{option(name='privacy')}} {{option(name='skip-thumbnail')}} {{option(name='skip-playlist')}}"
# Example: mise run upload -- 28
# Example: mise run upload -- 28 --dry-run
# Example: mise run upload -- 28 --privacy unlisted

[tasks.archive]
description = "Archive episode files after YouTube upload"
run = "python scripts/archive_episode.py"
raw = true
# Example: mise run archive -- 54  (single episode)
# Example: mise run archive        (all ready episodes)

[tasks.status]
description = "Generate whitepapers/status.json"
run = "python scripts/generate_status.py"

[tasks.download]
description = "Download papers from file: mise run download -- INPUT_FILE [--dry-run]"
run = "python scripts/download_papers.py"
raw = true
# Example: mise run download -- future/my-papers.md
# Example: mise run download -- future/my-papers.md --dry-run

[tasks.test]
description = "Run tests"
run = "pytest scripts/tests/ -v"
